{% extends 'base.html' %}
{% load static %}
{% block css %}


    <!-- Local Libraries Stylesheet -->
    <link href="{% static '/lib/animate/animate.min.css' %}" rel="stylesheet">
    <link href="{% static '/lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

    <!-- Local Customized Bootstrap Stylesheet -->
    <link href="{% static '/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Local Template Stylesheet -->
    <link href="{% static '/css/style.css' %}" rel="stylesheet">

    <style>
        /* Chat icon */
        #chat-icon {
            position: fixed; /* Fixed position */
            bottom: 40px; /* Adjusted to ensure chat icon is visible */
            left: 50px; /* Positioned on the left */
            font-size: 20px; /* Icon size */
            cursor: pointer;
            z-index: 1000; /* Ensure it is above other content */
            background-color: #007bff; /* Icon background color */
            color: #fff; /* Icon color */
            border-radius: 50%; /* Circular icon */
            padding: 10px; /* Padding around icon */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Shadow for depth */
            transition: background-color 0.3s, transform 0.3s; /* Smooth transitions */
        }

        #chat-icon:hover {
            background-color: #0056b3; /* Darker background on hover */
            transform: scale(1.1); /* Slightly increase size on hover */
        }

        /* Chat window */
        #chat-window {
            display: none;
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 500px;
            background-color: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        /* Chat header */
        #chat-header {
            background-color: #007bff;
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Chat messages */
        #chat-messages {
            padding: 10px;
            overflow-y: scroll;
            flex: 1; /* Allow chat messages to grow and take available space */
            display: flex;
            flex-direction: column;
        }

        /* Messages */
        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
            display: inline-block;
            clear: both;
        }

        .user-message {
            background-color: #007bff;
            color: white;
            margin-left: auto; /* Align to the right */
            text-align: right;
        }

        .answer-message {
            background-color: #f1f1f1;
            color: #000;
            margin-right: auto; /* Align to the left */
            text-align: left;
        }

        /* Input container */
        #chat-input-container {
            padding: 10px;
            display: flex;
            border-top: 1px solid #ddd;
        }

        #chat-input {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
            outline: none; /* Remove default input focus outline */
        }

        #send-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px;
            margin-left: 10px;
            border-radius: 10px;
            cursor: pointer;
        }

        #send-button i {
            font-size: 16px;
        }
    </style>



{% endblock %}
{{ open_requests }} {{ has_unread_messages }}

{% block content %}


    <!-- Carousel Start -->
    <div class="container-fluid p-0 mb-5 wow fadeIn" data-wow-delay="0.1s">
        <div id="header-carousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="w-100" src="{% static '/img/carousel-1.jpg' %}" alt="Carousel Image 1">
                    <div class="carousel-caption">
                        <div class="container">
                            <div class="row">
                                <div class="col-12 col-lg-6">
                                    <h1 class="display-3 text-dark mb-4 animated slideInDown">The Best Jurisdiction
                                        Begins Here</h1>
                                    <p class="fs-5 text-body mb-5">We specialize in
                                        providing expert legal consultation and services tailored to
                                        individuals and businesses navigating the complexities of U.S. law.
                                        Whether you need assistance with corporate formation, immigration,
                                        compliance, or litigation, our team is dedicated to offering precise,
                                        reliable, and strategic legal guidance every step of the way.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <img class="w-100" src="{% static '/img/carousel-2.jpg' %}" alt="Carousel Image 2">
                    <div class="carousel-caption">
                        <div class="container">
                            <div class="row">
                                <div class="col-12 col-lg-6">
                                    <h1 class="display-3 text-dark mb-4 animated slideInDown">The Best Jurisdiction
                                        Begins Here</h1>
                                    <p class="fs-5 text-body mb-5 text-dar">14 Years of Expertise in U.S. Legal
                                        Consulting
                                        With over a decade of experience in legal consulting, we specialize
                                        in guiding
                                        clients
                                        through complex legal processes, offering expert advice on everything from
                                        business formation to
                                        immigration,
                                        tax, and compliance issues. Our extensive knowledge ensures that you're in
                                        capable hands for
                                        every legal challenge."</p>>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#header-carousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#header-carousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>

    <!-- Carousel End -->


    <!-- Facts Start -->
    <div class="container-fluid overflow-hidden my-5 px-lg-0">
        <div class="container facts px-lg-0">
            <div class="row g-0 mx-lg-0">
                <div class="col-lg-6 facts-text wow fadeIn" data-wow-delay="0.1s">
                    <div class="h-100 px-4 ps-lg-0">
                        <h1 class="text-white mb-4">For Individuals And Organisations</h1>
                        <p class="text-light mb-5">We also take care of jurisdiction for private companies. Make your
                            future secure, get jurisdiction</p>
                        <a href="" class="align-self-start btn btn-secondary py-3 px-5">More Details</a>
                    </div>
                </div>
                <div class="col-lg-6 facts-counter wow fadeIn" data-wow-delay="0.5s">
                    <div class="h-100 px-4 pe-lg-0">
                        <div class="row g-5">
                            <div class="col-sm-6">
                                <h1 class="display-5" data-toggle="counter-up">120</h1>
                                <p class="fs-5 text-primary">Happy Clients</p>
                            </div>
                            <div class="col-sm-6">
                                <h1 class="display-5" data-toggle="counter-up">144</h1>
                                <p class="fs-5 text-primary">Projects Succeed</p>
                            </div>
                            <div class="col-sm-6">
                                <h1 class="display-5" data-toggle="counter-up">159</h1>
                                <p class="fs-5 text-primary">New projects</p>
                            </div>
                            <div class="col-sm-6">
                                <h1 class="display-5" data-toggle="counter-up">15</h1>
                                <p class="fs-5 text-primary">Potential projects</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Facts End -->


    <!-- Features Start -->
    <div class="container-xxl py-5">
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-6 wow fadeInUp" data-wow-delay="0.1s">
                    <h1 class="display-6 mb-5">Few Reasons Why People Choose Us!</h1>
                    <p class="mb-4">Choosing the right juridical company is critical to peace of mind and financial
                        security.
                        We stand out from the crowd with our unwavering commitment to our policyholders.
                        With a focus on personalized service, comprehensive coverage options and a reputation for
                        reliability,
                        We offer you the assurance you need to protect what matters most. Find out why countless people
                        and families trust
                        us to protect our future.</p>
                    <div class="row g-3">
                        <div class="col-sm-6 wow fadeIn" data-wow-delay="0.1s">
                            <div class="bg-light rounded h-100 p-3">
                                <div class="bg-white d-flex flex-column justify-content-center text-center rounded h-100 py-4 px-3">
                                    <img class="align-self-center mb-3"
                                         src="{% static '/img/icon/icon-06-primary.png' %}" alt="Icon 06 Primary">

                                    <h5 class="mb-0">Easy Process</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 wow fadeIn" data-wow-delay="0.2s">
                            <div class="bg-light rounded h-100 p-3">
                                <div class="bg-white d-flex flex-column justify-content-center text-center rounded py-4 px-3">
                                    <img class="align-self-center mb-3"
                                         src="{% static '/img/icon/icon-03-primary.png' %}" alt="Icon 03 Primary">

                                    <h5 class="mb-0">Fast Delivery</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 wow fadeIn" data-wow-delay="0.3s">
                            <div class="bg-light rounded h-100 p-3">
                                <div class="bg-white d-flex flex-column justify-content-center text-center rounded py-4 px-3">
                                    <img class="align-self-center mb-3"
                                         src="{% static '/img/icon/icon-04-primary.png' %}" alt="Icon 04 Primary">

                                    <h5 class="mb-0">Policy Controlling</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 wow fadeIn" data-wow-delay="0.4s">
                            <div class="bg-light rounded h-100 p-3">
                                <div class="bg-white d-flex flex-column justify-content-center text-center rounded h-100 py-4 px-3">
                                    <img class="align-self-center mb-3"
                                         src="{% static '/img/icon/icon-07-primary.png' %}" alt="Icon 07 Primary">

                                    <h5 class="mb-0">Money Saving</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 wow fadeInUp" data-wow-delay="0.5s">
                    <div class="position-relative rounded overflow-hidden h-100" style="min-height: 400px;">
                        <img class="position-absolute w-100 h-100" src="{% static '/img/feature.jpg' %}" alt="Feature"
                             style="object-fit: cover;">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Features End -->

    <!-- About Us Section Start -->
    <div class="about-us container-fluid py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="about-content">
                        <h2 class="about-title">About Us</h2>
                        <p class="about-text">
                            Eric's Consulting LLC was established on March 3, 2023, in Loveland, Ohio, USA.
                            The purpose of creating this company is to provide civil services to the members of the
                            Uzbek community living in America and to the brotherly peoples from the Central Asian
                            region.
                            This includes forming business entities, streamlining trucking company operations, and
                            providing
                            a wide range of services including placement assistance, license acquisition, loan support,
                            tax advice,
                            housing services, visa consultations, childcare, and school placement services.
                        </p>
                        <p class="about-text">
                            Our main goal is to offer affordable and high-quality services to Uzbek citizens living in
                            the USA!
                            The founder and head of the institution is lawyer Erkinbai Abdullaev, who brings 14 years of
                            experience from
                            various ministries and agencies of the republic, and 2 years of experience working in the
                            branch of a German
                            logistics company in Poland.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- About Us Section End -->


    <!-- Team Start -->
    <div class="container-fluid pt-5">
        <div class="container py-5">
            <div class="row align-items-end mb-4">
                <div class="col-lg-6">
                    <h6 class="text-mine font-weight-semi-bold text-uppercase mb-3">Meet Our Team</h6>
                    <h1 class="section-title mb-3">Meet Our Highly Experienced Team</h1>
                </div>
                <div class="col-lg-6">
                    <h4 class="font-weight-normal text-muted mb-3">
                        Our team is not only skilled but also dedicated to providing the best service possible. We value
                        professionalism and expertise in every aspect of our work.
                    </h4>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="owl-carousel team-carousel">
                        {% for member in team_members %}
                            <div class="team d-flex flex-column text-center rounded overflow-hidden">
                                <div class="position-relative team-member">
                                    <div class="team-img">
                                        {% if member.user.profile_picture %}
                                            <img class="img" src="{{ member.user.profile_picture.url }}"
                                                 alt="{{ member.user.first_name }} {{ member.user.last_name }}">
                                        {% else %}
                                            <img class="img-fluid" src="{% static 'img/logo-white.png' %}"
                                                 alt="Default Profile Picture">
                                        {% endif %}
                                    </div>
                                    <div class="team-overlay">
                                        <div class="team-social flex-column justify-content-center">
                                            {% if member.twitter is not None %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="{{ member.twitter }}"><i class="fab fa-x"></i></a>
                                            {% else %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="https://www.twitter.com/"><i class="fab fa-x"></i></a>
                                            {% endif %}
                                            {% if member.instagram is not None %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="{{ member.instagram }}"><i class="fab fa-instagram"></i></a>
                                            {% else %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="https://www.instagram.com/"><i
                                                        class="fab fa-instagram"></i></a>
                                            {% endif %}
                                            {% if member.facebook is not None %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="{{ member.facebook }}"><i class="fab fa-facebook-f"></i></a>
                                            {% else %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="https://www.facebook.com/"><i class="fab fa-facebook"></i></a>
                                            {% endif %}
                                            {% if member.linkedin is not None %}
                                                <a class="btn btn-secondary btn-social" href="{{ member.linkedin }}"><i
                                                        class="fab fa-linkedin-in"></i></a>
                                            {% else %}
                                                <a class="btn btn-secondary btn-social mb-2"
                                                   href="https://www.linkedin.com/"><i class="fab fa-linkedin"></i></a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class=" bg-primary text-center py-1">
                                    <h5 class="font-weight-bold"
                                        style="color: rgb(255,255,255)">{{ member.user.first_name }} {{ member.user.last_name }}</h5>
                                    <p class=" m-0" style="color: #989898">{{ member.role }}</p>
                                </div>
                                <!-- Description Section -->
                                <div class="team-description p-3">
                                    {% if member.description %}
                                        <p>{{ member.description }}</p>
                                    {% else %}
                                        <p>"Bringing a fresh perspective and innovative approach,
                                            <span class="team-member-name">{{ member.user.first_name }} {{ member.user.last_name }}</span>
                                            is instrumental in developing creative strategies and solutions.
                                            Their ability to think outside the box leads to effective problem-solving
                                            and improved processes."
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Team End -->



    {#Comment Start ----->#}

    <div class="container py-5">
        <h2 class="text-center mb-4" style="font-size: 2.5rem; font-weight: bold;">What People Are Saying</h2>
        <div class="row g-5">
            <div class="col-lg-8 mx-auto">
                <!-- Testimonial Carousel -->
                <div class="team-carousel owl-carousel" id="testimonial-carousel">  <!-- Added id for carousel -->
                    {% for comment in comments %}
                        <div class="testimonial-item text-center p-4 d-flex flex-column justify-content-between"
                             style="border-radius: 15px; background-color: #dadada; box-shadow: 5px 4px 15px rgba(0, 0, 0, 0.1); height: 300px;">
                            <!-- User's profile picture or default -->
                            <div class="mb-3">
                                <img class="img-fluid rounded-circle mx-auto mb-3"
                                        {% if comment.user.profile_picture %}
                                     src="{{ comment.user.profile_picture.url }}"
                                        {% else %}
                                     src="{% static 'img/icon/logo-white.png' %}"
                                        {% endif %}
                                     alt="{{ comment.user.first_name }}'s profile picture"
                                     style="width: 80px; height: 80px; object-fit: cover; border: 4px solid #007bff;">
                            </div>

                            <p class="fs-5" style="font-style: italic; color: #555; margin-bottom: 1rem;">
                                "{{ comment.content }}"
                            </p>
                            <div>
                                <h5 style="font-size: 1.2rem; font-weight: bold; color: rgba(0,123,255,0.9);">
                                    {{ comment.user.first_name }} {{ comment.user.last_name }}
                                </h5>
                                <span style="color: #999;">{{ comment.created_at|date:"F d, Y" }}</span>
                            </div>
                        </div>
                    {% empty %}
                    {% endfor %}
                </div>


                <!-- Comment Form for authenticated users -->
                {% if request.user.is_authenticated %}
                    <form method="POST" action="" class="mt-5 p-4"
                          style="border-radius: 15px; background-color: #dad8d8; box-shadow: 1px 4px 15px rgba(0, 0, 0, 0.1);">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="id_content" class="form-label">Leave a Comment:</label>
                            <textarea id="id_content" name="content" class="form-control" rows="4"
                                      placeholder="Write your comment here..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="background-color: #007bff; border: none;">
                            Submit Comment
                        </button>
                    </form>
                {% else %}
                    <p class="text-center mt-5">Commenting is available for registered users. Please <a
                            href="{% url 'login' %}">login</a> or <a href="{% url 'register' %}">register</a> to leave a
                        comment.</p>
                {% endif %}
            </div>
        </div>
    </div>



    <!-- Chat Icon -->
    <div id="chat-icon">
        <i class="fa fa-comments"></i>
    </div>

    <!-- Chat Window -->
    <div id="chat-window">
        <div id="chat-header">
            <span>Live Chat</span>
            <button id="chat-close-button">&times;</button>
        </div>
        <div id="chat-messages">
            <!-- Messages will be dynamically added here -->
        </div>

        <div id="chat-input-container">
            <input id="chat-input" type="text" placeholder="Type your message..."/>
            <button id="send-button"><i class="fa fa-paper-plane"></i></button>
        </div>
    </div>

{% endblock %}



{% block js %}

    <!-- Локальные JavaScript библиотеки -->
    <script src="/static/lib/wow/wow.min.js"></script>
    <script src="/static/lib/easing/easing.min.js"></script>
    <script src="/static/lib/waypoints/waypoints.min.js"></script>
    <script src="/static/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="/static/lib/counterup/counterup.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>

    <!-- Template JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>

    <script>
        $('.team-carousel').owlCarousel({
            loop: true,
            margin: 30,
            nav: true,
            navText: ['<i class="fa fa-chevron-left"></i>', '<i class="fa fa-chevron-right"></i>'],
            dots: true,
            autoplay: true,
            autoplayTimeout: 3000,
            autoplayHoverPause: true,
            smartSpeed: 1000,
            responsive: {
                0: {
                    items: 1  // Display 1 item at all screen sizes
                },
                576: {
                    items: 1  // Display 1 item at all screen sizes
                },
                992: {
                    items: 3 // Display only 1 item instead of 3
                }
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            $('[data-toggle="counter-up"]').counterUp({
                delay: 10,
                time: 1000
            });
        });
    </script>

    <script>
        $(document).ready(function () {

            function fetchChatHistory() {
                $.ajax({
                    url: '{% url "chat_with_bot" %}',
                    method: 'GET',
                    success: function (response) {
                        console.log('Chat history response:', response);

                        $('#chat-messages').empty();

                        response.chat_history.forEach(function (message) {
                            var messageClass = message.sender === 'user' ? 'user-message' : 'answer-message';
                            $('#chat-messages').append('<div class="message ' + messageClass + '">' + escapeHtml(message.text) + '</div>');
                        });

                        // Scroll to the bottom to show the latest messages
                        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
                    },
                    error: function (error) {
                        console.error('Error fetching chat history:', error); // Log error
                    }
                });
            }

            function scrollToBottom() {
                $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
            }

            // Hide chat window initially
            $('#chat-window').hide();

            // Toggle chat window visibility
            $('#chat-icon').on('click', function () {
                $('#chat-window').toggle(); // Show/Hide the chat window
                if ($('#chat-window').is(':visible')) {
                    fetchChatHistory(); // Fetch chat history when opening the chat window
                }
            });

            // Close button for chat window
            $('#chat-close-button').on('click', function () {
                $('#chat-window').hide(); // Hide chat window when clicked
            });

            // Function to send message
            function sendMessage(userMessage) {
                // Append user message to chat window
                $('#chat-messages').append('<div class="message user-message">' + escapeHtml(userMessage) + '</div>');
                $('#chat-input').val('');  // Clear input field

                scrollToBottom();

                // Send message via AJAX POST request
                $.ajax({
                    url: '{% url "chat_with_bot" %}',  // URL to Django view handling messages
                    method: 'POST',
                    data: {
                        'message': userMessage,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        // Append bot response to the chat window
                        response.messages.forEach(function (msg) {
                            $('#chat-messages').append('<div class="message answer-message">' + escapeHtml(msg.text) + '</div>');
                        });

                        // Scroll to the bottom after receiving the bot response
                        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
                    },
                    error: function (error) {
                        if (error.status === 401) {
                            $('#chat-messages').append('<div  class="message error-message">You must log in or register to use the chatbot.</div>');
                        } else {
                            console.error('Error sending message:', error); // Log error if message sending fails
                        }
                    }
                });
            }

            // Send message on button click
            $('#send-button').on('click', function () {
                var userMessage = $('#chat-input').val();
                if (userMessage.trim()) {
                    sendMessage(userMessage);  // Call sendMessage function
                }
            });

            $('#chat-input').on('keypress', function (e) {
                if (e.which === 13 && !e.shiftKey) {
                    e.preventDefault();
                    var userMessage = $('#chat-input').val();
                    if (userMessage.trim()) {
                        sendMessage(userMessage);  // Call sendMessage function
                    }
                }
            });

            // Escape HTML to prevent XSS
            function escapeHtml(text) {
                var map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, function (m) {
                    return map[m];
                });
            }

        });

    </script>


{% endblock %}