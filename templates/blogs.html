{% extends 'base.html' %}
{% load static %}

{% block css %}
    <!-- Local Libraries Stylesheet -->
    <link href="{% static 'lib/animate/animate.min.css' %}" rel="stylesheet">

    <!-- Local Customized Bootstrap Stylesheet -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Local Template Stylesheet -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">

    <style>
    .blog-wrap {
            position: relative;
            background-size: cover;
            background-position: center;
            height: 400px;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }


.blog-wrap .blog-overlay {
            position: absolute;
            background-image: url("{% static 'img/blogpost.jpg' %}");
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

.blog-wrap .slider-text {
            position: relative;
            z-index: 2;
            text-align: center;
        }

    </style>
{% endblock %}

{% block content %}

    <section class="blog-wrap">
        <div class="blog-overlay">
        </div>
        <div class="slider-text">
        </div>
    </section>
    <div class="text-md-center" style=" font-style: inherit; color: rgb(84,84,84); font-size: xxx-large; margin-top: 50px; margin-bottom: -50px;
            ">Welcome to our Blog-Page hope you will enjoy it </div>

    <!-- Blog Section Start -->
    <div class="container-fluid pt-5">
        <div class="container py-5">
            <div class="row">
                {% for post in blogs %}
                <div class="col-md-6 mb-4">
                    <div class="blog-post">
                        <!-- Display Theme/Title (Name) -->
                        <h3>{{ post.theme }}</h3>

                        <!-- Display file content if it exists (Video/Photo) -->
                        {% if post.file %}
                            {% if post.file.url|slice:"-4:" == ".mp4" %}
                                <video controls class="media-content">
                                    <source src="{{ post.file.url }}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            {% elif post.file.url|slice:"-4:" == ".jpg" or post.file.url|slice:"-4:" == ".png" %}
                                <img src="{{ post.file.url }}" class="media-content" alt="Blog Image">
                            {% else %}
                                <p>Unsupported file type.</p>
                            {% endif %}
                        {% endif %}

                        <!-- Display Content -->
                        <p>{{ post.content|truncatewords:30 }}</p>

                        <!-- Display Posted Date -->
                        <p class="text-muted">Posted on {{ post.created_at|date:"F j, Y" }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <!-- Blog Section End -->
    
{% endblock %}


{% block js %}
    <!-- Local JavaScript Libraries -->
    <script src="{% static 'lib/wow/wow.min.js' %}"></script>
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/counterup/counterup.min.js' %}"></script>

    <!-- Template Javascript -->
    <script src="{% static 'js/main.js' %}"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const posts = document.querySelectorAll('.blog-post');
        const videos = document.querySelectorAll('video'); // Select all video elements
        let currentIndex = 0;

        function scrollToPost(index) {
            if (index < 1 || index >= posts.length) return;
            posts[index].scrollIntoView({ behavior: 'smooth' });
        }

        function pauseAllVideos() {
            videos.forEach(video => {
                video.pause(); // Pause all videos
                video.currentTime = 0; // Reset to the beginning
            });
        }

        window.addEventListener('scroll', function() {
            const scrollPosition = window.scrollY + window.innerHeight;
            const postHeight = posts[0].offsetHeight;

            if (scrollPosition >= (currentIndex + 1) * postHeight) {
                currentIndex++;
                if (currentIndex < posts.length) {
                    pauseAllVideos(); // Pause all videos when moving to the next post
                    scrollToPost(currentIndex);
                }
            } else if (scrollPosition <= currentIndex * postHeight) {
                currentIndex--;
                if (currentIndex >= 0) {
                    pauseAllVideos(); // Pause all videos when moving to the previous post
                    scrollToPost(currentIndex);
                }
            }
        });

        // Initial scroll to the first post
        scrollToPost(0);
    });
    </script>
{% endblock %}
